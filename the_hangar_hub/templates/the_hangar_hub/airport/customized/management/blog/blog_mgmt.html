{% extends 'base/template/standard/template.html' %}
{% load base_taglib %}
{% load upload_taglib %}
{% load static %}

{%block title%}Customize Content for {{airport.display_name}}{%endblock%}
{% block scripts %}
    {%wysiwyg%}
{%endblock%}

{% block main_content %}
<h1>Airport Blog/News</h1>

<div class="float-right" style="max-width:800px;">
    <form method="get" class="mb-3">
      <div class="input-group">
        <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Search title or contentâ€¦">
        <button class="btn btn-outline-secondary" type="submit">Search</button>
      </div>
    </form>
</div>
<br style="clear:both;" />

<div class="content-800 content-center">
    <form method="post" action="{%url 'airport:blog_post' airport.identifier%}" enctype="multipart/form-data" class="mb-4">
        {% csrf_token %}
        <div class="card">
            <div class="card-header"><h2 class="">{%icon bi-file-earmark-plus%} New Blog Entry</h2></div>
            <div class="card-body">
                <div class="mb-2">
                    <label class="visually-hidden" for="blog-title">Title</label>
                    <input type="text" id="new-title" name="title" value="{{prefill.title|default:''}}" class="form-control" placeholder="Title" autofocus />
                </div>
                <div class="mb-2">
                    <label class="visually-hidden" for="blog-content">Blog/News Story</label>
                    {%with wysiwyg_prefill=prefill.content|default:''%}
                    {%wysiwyg_input id="new-content" name="content" value=wysiwyg_prefill  placeholder="Your post's content goes here..."%}
                    {%endwith%}
                </div>

                {%for image in pending_images%}
                    {%file_preview file=image class="img-fluid img-rounded mb-3" style="max-height:200px;"%}
                {%endfor%}

                <div class="mb-2">
                    {%include 'base/upload/_dnd_input.html' with input_name="blog_file" upload_url="airport:blog_upload" upload_url_arg=airport.identifier %}
                    {%include 'base/upload/_dnd_assets.html'%}
                </div>
                <button class="btn btn-primary" type="submit">Publish</button>
            </div>
        </div>
    </form>
</div>

<h2 class="mt-4">Existing entries</h2>
{% if entries %}
  <div class="list-group">
    {% for entry in entries %}
        <div class="list-group-item" data-entry_id="{{entry.id}}" id="lgi-{{entry.id}}">
            {%with uploaded_image=entry.main_image%}
            <div class="float-left" style="margin-right: 10px;">
            {% if uploaded_image %}
                {%file_preview file=uploaded_image aria-hidden="true" class="img-fluid img-rounded mt-2 mb-2" style="max-width: 260px; max-height: 120px;"%}
            {% else %}
                <img src="{% static 'images/bs-cards/blog-placeholder-3.png' %}" aria-hidden="true" class="img-fluid img-rounded mt-2 mb-2" style="max-width: 260px; max-height: 120px;" />
            {% endif %}
            </div>
            {% endwith %}
            <div class="float-left">
                <b class="mb-1 heading xl">{{ entry.title }}</b><br />
                <p class="mb-1" style="white-space: pre-wrap">{{ entry.content_summary }}</p>
            </div>
            <div class="float-right">
                <small>{{ entry.date_created|date:"Y-m-d H:i" }}</small><br />
                <div class="mt-2" style="text-align:right;">
                    {%icon bi-pencil-square title="Edit Blog Entry" onclick="update_entry($(this));"%}
                    {%icon bi-trash text-danger title="Delete Blog Entry" onclick="delete_entry($(this));"%}
                </div>
            </div>
            <br style="clear:both;" />
        </div>
    {% endfor %}
  </div>

    <div class="popup hidden" id="blog-edit-container" style="max-width:850px;">

    </div>

  <nav class="mt-3">
    <ul class="pagination">
      {% if page_obj.has_previous %}
        <li class="page-item"><a class="page-link" href="?q={{ q }}&page={{ page_obj.previous_page_number }}">Previous</a></li>
      {% endif %}
      <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>
      {% if page_obj.has_next %}
        <li class="page-item"><a class="page-link" href="?q={{ q }}&page={{ page_obj.next_page_number }}">Next</a></li>
      {% endif %}
    </ul>
  </nav>
{% else %}
  <p class="text-muted">No entries yet.</p>
{% endif %}


<script type="text/javascript">
    {%include "the_hangar_hub/airport/customized/management/blog/blog.js"%}
</script>
{% endblock %}