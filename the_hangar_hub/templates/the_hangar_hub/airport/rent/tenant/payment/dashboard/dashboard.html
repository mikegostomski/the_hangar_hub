{% extends 'base/template/standard/template.html' %}
{% load base_taglib %}

{%block title%}Payment Dashboard{%endblock%}

{% block main_content %}
<h1>Payment Dashboard</h1>
<br />

<section>

</section>


<h2>Payment Information</h2>
<section>
    <table class="table" style="max-width: 800px;">
        <tr>
            <th scope="row">Email</th>
            <td>{{stripe_customer.email}}</td>
        </tr>
        <tr>
            <th scope="row">Account Status</th>
            <td>
                {%if stripe_customer.delinquent%}
                    <div class="alert alert-danger text-center alert-sm">Delinquent</div>
                {%else%}
                    Active
                {%endif%}
            </td>
        </tr>
        <tr>
            <th scope="row">Default Payment Method</th>
            <td>
                {%if stripe_customer.default_payment%}
                    {{stripe_customer.default_payment}}
                {%else%}
                    <div class="alert alert-danger text-center alert-sm">No Payment Method</div>
                {%endif%}
            </td>
        </tr>
        <tr>
            <th scope="row">Billing Portal</th>
            <td>
                <p class="text-sm">
                We use Stripe to securely handle all billing and payments.<br />
                You can manage your payment information in the Stripe Customer Portal.<br />
                Be sure to use <b>{{stripe_customer.email}}</b> as your email address.<br />
                </p>
                <div class="">
                <a href="{{'STRIPE_PORTAL_LINK'|get_setting}}" class="btn btn-primary btn-sm" target="_blank">
                    <span class="visually-hidden">manage your payment information in the</span>
                    Stripe Customer Portal
                </a>
                </div>
            </td>
        </tr>
    </table>
</section>

{%for rental_agreement in rental_agreements%}
    <h2>Hangar {{rental_agreement.hangar.code}} at {{rental_agreement.airport.identifier}}</h2>
    {%include "the_hangar_hub/airport/rent/summaries/_cards.html"%}

    <section>
    {%if rental_agreement.relevant_invoice_models%}
        <h2>Invoices</h2>
        <table class="table" id="invoice_table">
            <tr>
                <th scope="col">Created</th>
                <th scope="col">Period</th>
                <th scope="col">Collection Method</th>
                <th scope="col">Charged</th>
                <th scope="col">Paid</th>
                <th scope="col">Status</th>
                <th scope="col">Actions</th>
            </tr>
            {%for invoice in rental_agreement.relevant_invoice_models%}
                {%include "the_hangar_hub/airport/rent/tenant/payment/dashboard/_invoice_tr.html"%}
            {%endfor%}
        </table>

        {%include "the_hangar_hub/airport/rent/management/invoices/_form_record_payment.html"%}
    {%endif%}
    </section>

{%endfor%}





<script type="text/javascript">
    {%include "the_hangar_hub/airport/rent/tenant/payment/dashboard/script.js"%}
</script>

{%endblock%}